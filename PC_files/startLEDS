#!/bin/bash
# copy python files and colors from wal to raspi, and start leds.

# this is the default directory for the colors.json generated by pywal. If
# yours is different, put the path here.
COLORS_DIR="$HOME/.cache/wal/colors.json"

# Path to your cloned pyWalNeopixels repo.
REPO_DIR="$HOME/Documents/GitHub/pyWalNeopixels"

USER="pi"
IP=192.168.0.25

# This is the user@ipaddr of your raspi.
USER_IP=$USER@$IP

# Directory to PC_files
PC_files="$REPO_DIR/PC_files"

# Location for files to be copied to raspi. This can be whatever you'd like, as
# the directory will be created when the script is run. NOTE: if you change
# this, you must also adjust the corresponding file path in
# raspi_files/cycleColors.py
DEST_DIR="/home/$USER/.LEDS"

ssh $USER_IP "test -e $DEST_DIR/raspi_files/cycleColors.py"
if [ $? -eq 0 ]; then
  echo raspi files exist, sending colors...
  
else
  echo files did not exist on raspi, sending with scp...
  echo making destination directory...
  ssh $USER_IP "mkdir $DEST_DIR"

  echo changing directory...
  cd $REPO_DIR

  echo compressing files to be sent to raspi...
  tar -czvf $REPO_DIR/pkg.tar.gz raspi_files 

  echo sending files to raspi...
  scp $REPO_DIR/pkg.tar.gz $USER_IP:$DEST_DIR

  echo unpacking files...
  ssh $USER_IP "tar -xzvf $DEST_DIR/pkg.tar.gz -C $DEST_DIR"
fi

echo killing old cycleColors instances...
ssh $USER_IP "sudo kill \$(ps aux | grep cycleColors.py | awk '{print \$2}' | head -1)"

scp $COLORS_DIR $USER_IP:$DEST_DIR/raspi_files

echo starting LEDs...
ssh $USER_IP "sudo python3 $DEST_DIR/raspi_files/cycleColors.py" &

